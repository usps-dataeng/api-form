<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Azure Compute Cost Analysis Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, #0066cc, #004499);
            color: white;
            padding: 30px 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 18px;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1600px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .summary-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 25px rgba(0,0,0,0.1);
            border-left: 6px solid #0066cc;
        }
        
        .summary-card.critical {
            border-left-color: #dc3545;
        }
        
        .summary-card.opportunity {
            border-left-color: #28a745;
        }
        
        .summary-card h3 {
            font-size: 16px;
            color: #666;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .summary-card .amount {
            font-size: 36px;
            font-weight: bold;
            color: #0066cc;
            margin-bottom: 8px;
        }
        
        .summary-card.critical .amount {
            color: #dc3545;
        }
        
        .summary-card.opportunity .amount {
            color: #28a745;
        }
        
        .summary-card .period {
            color: #666;
            font-size: 14px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .section-header {
            background: #0066cc;
            color: white;
            padding: 25px;
            font-size: 20px;
            font-weight: 600;
        }
        
        .section-content {
            padding: 30px;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 30px;
        }
        
        .cost-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 13px;
        }
        
        .cost-table th {
            background: #f8f9fa;
            padding: 15px 10px;
            text-align: left;
            font-weight: 600;
            color: #333;
            border-bottom: 2px solid #dee2e6;
            font-size: 12px;
        }
        
        .cost-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .cost-high { 
            color: #dc3545; 
            font-weight: bold; 
        }
        
        .cost-medium { 
            color: #f39c12; 
            font-weight: bold; 
        }
        
        .cost-low { 
            color: #28a745; 
            font-weight: bold; 
        }
        
        .sku-name {
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: #0066cc;
            font-weight: bold;
        }
        
        .optimization-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 6px 25px rgba(0,0,0,0.1);
            padding: 30px;
            margin-top: 30px;
        }
        
        .optimization-section h3 {
            color: #0066cc;
            margin-bottom: 25px;
            font-size: 22px;
        }
        
        .optimization-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .optimization-card {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 25px;
            text-align: center;
        }
        
        .optimization-card.high-impact {
            border-color: #28a745;
            background: #f8fff9;
        }
        
        .optimization-card.medium-impact {
            border-color: #ffc107;
            background: #fffdf3;
        }
        
        .optimization-card.critical {
            border-color: #dc3545;
            background: #fef8f8;
        }
        
        .optimization-card h4 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }
        
        .optimization-card .savings {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .optimization-card.high-impact .savings { color: #28a745; }
        .optimization-card.medium-impact .savings { color: #f39c12; }
        .optimization-card.critical .savings { color: #dc3545; }
        
        .action-items {
            background: #e8f5e8;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
        }
        
        .action-items h4 {
            color: #28a745;
            margin-bottom: 20px;
            font-size: 18px;
        }
        
        .action-items ul {
            list-style-type: none;
            padding-left: 0;
        }
        
        .action-items li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
            font-size: 14px;
        }
        
        .action-items li:before {
            content: "üéØ";
            position: absolute;
            left: 0;
        }
        
        .databricks-section {
            background: #fff3e0;
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 25px;
            margin-top: 20px;
        }
        
        .databricks-section h4 {
            color: #ff9800;
            margin-bottom: 15px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üñ•Ô∏è Azure Compute Cost Analysis & Optimization</h1>
        <p>Comprehensive Investigation: From Cost Discovery to Strategic Action Plan</p>
    </div>
    
    <div class="container">
        <!-- Executive Summary -->
        <div class="section">
            <div class="section-header">üìã Executive Summary</div>
            <div class="section-content">
                <p><strong>Investigation Purpose:</strong> Analyze Azure Compute Service Family costs to identify drivers and optimization opportunities.</p>
                <p><strong>Scope:</strong> Comprehensive analysis across EDL, IV, and UAPSAL environments using Azure Cost Analysis, Resource Graph Explorer, and Performance Monitor.</p>
                <p><strong>Key Findings:</strong> 87 VMs costing $110,975/month with significant over-provisioning and idle resources.</p>
            </div>
        </div>

        <!-- Investigation Process -->
        <div class="section">
            <div class="section-header">üîç Investigation Process</div>
            <div class="section-content">
                <h4>1. Azure Cost Analysis</h4>
                <ul>
                    <li>Filtered by Meter and Resource Type in Azure Cost Management</li>
                    <li>Identified high-cost SKUs: Standard_L32s_v3, Standard_L16s_v3, Standard_F64s_v2</li>
                    <li>Discovered resource filtering showed no results, indicating deeper investigation needed</li>
                </ul>
                
                <h4>2. Azure Resource Graph Explorer</h4>
                <p>Used this query to identify VM configurations:</p>
                <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; font-size: 12px; overflow-x: auto;">
Resources
| where type == 'microsoft.compute/virtualmachines'
| where resourceGroup == 'databricks-rg-edl-prod-databricks-dbws-qs73amr43fyx4'
| project name, location, resourceGroup,
    sku = tostring(properties.hardwareProfile.vmSize),
    powerState = tostring(properties.extended.instanceView.powerState.code),
    createdTime = tostring(properties.timeCreated)
                </pre>
                
                <h4>3. Performance Analysis</h4>
                <ul>
                    <li>Used Azure Monitor > Workbooks > Performance Analysis</li>
                    <li>Analyzed 60-day performance metrics for CPU, memory, network, and disk utilization</li>
                    <li>Discovered extremely low utilization across Data Factory VMs</li>
                </ul>
            </div>
        </div>

        <!-- Cost Driver Analysis -->
        <div class="section">
            <div class="section-header">üéØ Primary Cost Drivers - What Makes Azure VMs Expensive</div>
            <div class="section-content">
                <h4>Understanding Azure VM Pricing Model</h4>
                <p>Azure VMs are charged <strong>by the hour, 24/7</strong>, based on four key factors:</p>
                <ul>
                    <li><strong>vCPUs (Virtual CPUs):</strong> More cores = higher cost</li>
                    <li><strong>Memory (RAM):</strong> More memory = significantly higher cost</li>
                    <li><strong>Storage Type:</strong> Premium SSD vs Standard storage</li>
                    <li><strong>VM Series:</strong> Specialized series (L, F, E) cost more than general-purpose (D, B)</li>
                </ul>
                
                <h4>Why Our Costs Are So High - The "Premium SKU Problem"</h4>
                <table class="cost-table">
                    <thead>
                        <tr>
                            <th>VM Series</th>
                            <th>Purpose</th>
                            <th>Why It's Expensive</th>
                            <th>Our Usage</th>
                            <th>Cost Impact</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="sku-name">L-Series (Storage Optimized)</td>
                            <td>High-performance storage, large local SSD</td>
                            <td class="cost-high">32-256 GB RAM + Premium NVMe SSDs</td>
                            <td>48 VMs</td>
                            <td class="cost-high">$67,056/month</td>
                        </tr>
                        <tr>
                            <td class="sku-name">F-Series (Compute Optimized)</td>
                            <td>CPU-intensive workloads</td>
                            <td class="cost-high">High CPU-to-memory ratio + premium processors</td>
                            <td>14 VMs</td>
                            <td class="cost-high">$23,386/month</td>
                        </tr>
                        <tr>
                            <td class="sku-name">E-Series (Memory Optimized)</td>
                            <td>Memory-intensive applications</td>
                            <td class="cost-medium">High memory-to-CPU ratio</td>
                            <td>13 VMs</td>
                            <td class="cost-medium">$12,306/month</td>
                        </tr>
                        <tr>
                            <td class="sku-name">D-Series (General Purpose)</td>
                            <td>Balanced compute/memory</td>
                            <td class="cost-low">Standard balanced resources</td>
                            <td>12 VMs</td>
                            <td class="cost-low">$8,227/month</td>
                        </tr>
                    </tbody>
                </table>
                
                <h4>The Real Cost Drivers in Our Environment</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="background: #fef8f8; padding: 15px; border-radius: 8px; border-left: 4px solid #dc3545;">
                        <h5 style="color: #dc3545; margin-bottom: 10px;">üî• TOP COST DRIVER</h5>
                        <p><strong>Standard_L32s_v3 (18 VMs)</strong></p>
                        <ul style="font-size: 13px; margin: 10px 0;">
                            <li>32 vCPUs + 256 GB RAM</li>
                            <li>2.9 TB local NVMe SSD</li>
                            <li>$2,032/month per VM</li>
                            <li><strong>Why expensive:</strong> Premium storage + massive memory</li>
                        </ul>
                    </div>
                    <div style="background: #fff3e0; padding: 15px; border-radius: 8px; border-left: 4px solid #f39c12;">
                        <h5 style="color: #f39c12; margin-bottom: 10px;">‚ö° COMPUTE INTENSIVE</h5>
                        <p><strong>Standard_F64s_v2 (4 VMs)</strong></p>
                        <ul style="font-size: 13px; margin: 10px 0;">
                            <li>64 vCPUs + 128 GB RAM</li>
                            <li>High-performance Intel processors</li>
                            <li>$3,599/month per VM</li>
                            <li><strong>Why expensive:</strong> Massive CPU allocation</li>
                        </ul>
                    </div>
                </div>
                
                <h4>How Databricks Amplifies These Costs</h4>
                <p><strong>The Databricks Cost Multiplier Effect:</strong></p>
                <ul>
                    <li><strong>Auto-Provisioning:</strong> Databricks automatically selects premium SKUs (L-series, F-series) for performance</li>
                    <li><strong>Always-On Clusters:</strong> Interactive clusters stay running even when idle</li>
                    <li><strong>Scale-Out Pattern:</strong> Creates multiple large VMs instead of fewer smaller ones</li>
                    <li><strong>No Cost Awareness:</strong> Default cluster configs prioritize performance over cost</li>
                </ul>
                
                <div style="background: #d1ecf1; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong>Real Example:</strong> A single Databricks job might spin up a Standard_L32s_v3 cluster with 10 nodes, costing $20,320/month, when the same job could run on Standard_D8s_v3 nodes costing $5,600/month - a 73% cost difference for the same work.
                </div>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card critical">
                <h3>Total VM Count</h3>
                <div class="amount">87 VMs</div>
                <div class="period">Across all resource groups and environments</div>
            </div>
            <div class="summary-card critical">
                <h3>Current Monthly Cost</h3>
                <div class="amount">$110,975</div>
                <div class="period">Estimated compute costs across all environments</div>
            </div>
            <div class="summary-card opportunity">
                <h3>Optimization Potential</h3>
                <div class="amount">$66,000+</div>
                <div class="period">Monthly savings through spot instances alone</div>
            </div>
            <div class="summary-card opportunity">
                <h3>Annual Savings</h3>
                <div class="amount">$792K+</div>
                <div class="period">With comprehensive optimization strategy</div>
            </div>
        </div>
        
        <!-- Detailed Findings -->
        <div class="section">
            <div class="section-header">üîç Detailed Investigation Findings</div>
            <div class="section-content">
                <h4>What We Discovered Through Azure Cost Analysis</h4>
                <p>When filtering Azure costs by Compute Service Family, we found:</p>
                <ul>
                    <li><strong>$116,707/month</strong> total compute costs across all environments</li>
                    <li><strong>Virtual Machines:</strong> $86,922 (74% of compute costs)</li>
                    <li><strong>VM Scale Sets:</strong> $29,786 (26% of compute costs)</li>
                    <li><strong>App Services:</strong> $166 (<1% of compute costs)</li>
                </ul>
                
                <h4>Why Resource Filtering Showed No Results</h4>
                <p>Initial filtering by "Resource" in Cost Analysis returned no data because:</p>
                <ul>
                    <li>Many costs are aggregated at the subscription or resource group level</li>
                    <li>Ephemeral VMs (created and destroyed frequently) don't appear in resource-level views</li>
                    <li>Databricks auto-provisions VMs with cryptic hash names, making them hard to track</li>
                </ul>
                
                <h4>Azure Resource Graph Investigation Results</h4>
                <p>Using Resource Graph Explorer, we identified <strong>87 total VMs</strong> across environments:</p>
                <table class="cost-table">
                    <thead>
                        <tr>
                            <th>Environment</th>
                            <th>VM Count</th>
                            <th>Primary Use Case</th>
                            <th>Estimated Monthly Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>EDL Production Databricks</td>
                            <td>57</td>
                            <td>Data processing, analytics jobs</td>
                            <td class="cost-high">$81,099</td>
                        </tr>
                        <tr>
                            <td>IV Production</td>
                            <td>12</td>
                            <td>Data ingestion, Kafka processing</td>
                            <td class="cost-medium">$15,600</td>
                        </tr>
                        <tr>
                            <td>UAPSAL Production</td>
                            <td>6</td>
                            <td>Data factory workloads</td>
                            <td class="cost-medium">$8,200</td>
                        </tr>
                        <tr>
                            <td>Development/Test</td>
                            <td>12</td>
                            <td>Testing, development, admin</td>
                            <td class="cost-low">$6,076</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Cost Comparison Analysis -->
        <div class="section">
            <div class="section-header">üí∞ Current vs. Optimized Cost Comparison</div>
            <div class="section-content">
                <h4>High-Cost VM SKU Analysis</h4>
                <table class="cost-table">
                    <thead>
                        <tr>
                            <th>VM SKU</th>
                            <th>Count</th>
                            <th>Current Monthly Cost</th>
                            <th>Optimized SKU</th>
                            <th>Optimized Cost</th>
                            <th>Monthly Savings</th>
                            <th>Annual Savings</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="sku-name">Standard_L32s_v3</td>
                            <td>18</td>
                            <td class="cost-high">$36,576</td>
                            <td class="sku-name">Standard_E32ds_v4</td>
                            <td class="cost-medium">$30,276</td>
                            <td class="cost-low">$6,300</td>
                            <td class="cost-low">$75,600</td>
                        </tr>
                        <tr>
                            <td class="sku-name">Standard_L16s_v3</td>
                            <td>30</td>
                            <td class="cost-high">$30,480</td>
                            <td class="sku-name">Standard_E16ds_v4</td>
                            <td class="cost-medium">$20,480</td>
                            <td class="cost-low">$10,000</td>
                            <td class="cost-low">$120,000</td>
                        </tr>
                        <tr>
                            <td class="sku-name">Standard_F64s_v2</td>
                            <td>4</td>
                            <td class="cost-high">$14,396</td>
                            <td class="sku-name">Standard_E16s_v4</td>
                            <td class="cost-medium">$4,612</td>
                            <td class="cost-low">$9,784</td>
                            <td class="cost-low">$117,408</td>
                        </tr>
                        <tr>
                            <td class="sku-name">Standard_F16</td>
                            <td>10</td>
                            <td class="cost-medium">$8,990</td>
                            <td class="sku-name">Standard_D8ads_v5</td>
                            <td class="cost-low">$4,380</td>
                            <td class="cost-low">$4,610</td>
                            <td class="cost-low">$55,320</td>
                        </tr>
                    </tbody>
                </table>
                <p><strong>Right-Sizing Total:</strong> $30,694/month savings ($368,328 annually)</p>
                
                <h4>Spot Instance Opportunity Analysis</h4>
                <p><strong>What are Spot Instances?</strong> Azure Spot VMs use excess Azure capacity at up to 80% discount. They can be evicted when Azure needs the capacity, making them perfect for:</p>
                <ul>
                    <li>Batch processing jobs (like Databricks data ingestion)</li>
                    <li>Fault-tolerant workloads that can be retried</li>
                    <li>Development and testing environments</li>
                    <li>Non-critical background processing</li>
                </ul>
                
                <table class="cost-table">
                    <thead>
                        <tr>
                            <th>Workload Type</th>
                            <th>VM Count</th>
                            <th>Current Monthly Cost</th>
                            <th>Spot Monthly Cost (70% savings)</th>
                            <th>Monthly Savings</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Databricks Job Clusters</td>
                            <td>40</td>
                            <td class="cost-high">$65,000</td>
                            <td class="cost-medium">$19,500</td>
                            <td class="cost-low">$45,500</td>
                        </tr>
                        <tr>
                            <td>Data Factory Batch Jobs</td>
                            <td>6</td>
                            <td class="cost-medium">$8,200</td>
                            <td class="cost-low">$2,460</td>
                            <td class="cost-low">$5,740</td>
                        </tr>
                        <tr>
                            <td>Development/Test VMs</td>
                            <td>8</td>
                            <td class="cost-medium">$4,500</td>
                            <td class="cost-low">$1,350</td>
                            <td class="cost-low">$3,150</td>
                        </tr>
                    </tbody>
                </table>
                <p><strong>Spot Instance Total:</strong> $54,390/month savings ($652,680 annually)</p>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Cost Breakdown Chart -->
            <div class="section">
                <div class="section-header">
                    üìä Cost Breakdown by VM SKU
                </div>
                <div class="section-content">
                    <div class="chart-container">
                        <canvas id="skuCostChart"></canvas>
                    </div>
                    
                    <table class="cost-table">
                        <thead>
                            <tr>
                                <th>VM SKU</th>
                                <th>Count</th>
                                <th>Primary Subscription</th>
                                <th>vCPUs</th>
                                <th>Memory</th>
                                <th>Cost/VM/Month</th>
                                <th>Total Monthly Cost</th>
                                <th>Annual Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="sku-name">Standard_L32s_v3</td>
                                <td>18</td>
                                <td>uspscio-it-edl-4548-00p</td>
                                <td>32</td>
                                <td>256 GB</td>
                                <td class="cost-high">$2,032</td>
                                <td class="cost-high">$36,576</td>
                                <td class="cost-high">$438,912</td>
                            </tr>
                            <tr>
                                <td class="sku-name">Standard_L16s_v3</td>
                                <td>30</td>
                                <td>uspscio-it-edl-4548-00p</td>
                                <td>16</td>
                                <td>128 GB</td>
                                <td class="cost-high">$1,016</td>
                                <td class="cost-high">$30,480</td>
                                <td class="cost-high">$365,760</td>
                            </tr>
                            <tr>
                                <td class="sku-name">Standard_F64s_v2</td>
                                <td>4</td>
                                <td>uspscio-it-edl-4548-00p</td>
                                <td>64</td>
                                <td>128 GB</td>
                                <td class="cost-high">$3,599</td>
                                <td class="cost-high">$14,396</td>
                                <td class="cost-high">$172,752</td>
                            </tr>
                            <tr>
                                <td class="sku-name">Standard_F16</td>
                                <td>10</td>
                                <td>uspscio-it-edl-4548-00p</td>
                                <td>16</td>
                                <td>32 GB</td>
                                <td class="cost-medium">$899</td>
                                <td class="cost-medium">$8,990</td>
                                <td class="cost-medium">$107,880</td>
                            </tr>
                            <tr>
                                <td class="sku-name">Standard_E8ds_v4</td>
                                <td>9</td>
                                <td>uspscio-it-edl-4548-00p</td>
                                <td>8</td>
                                <td>64 GB</td>
                                <td class="cost-medium">$576</td>
                                <td class="cost-medium">$5,184</td>
                                <td class="cost-medium">$62,208</td>
                            </tr>
                            <tr>
                                <td class="sku-name">Standard_E8s_v3</td>
                                <td>5</td>
                                <td>uspscio-it-edl-4548-00p</td>
                                <td>8</td>
                                <td>64 GB</td>
                                <td class="cost-medium">$875</td>
                                <td class="cost-medium">$4,375</td>
                                <td class="cost-medium">$52,500</td>
                            </tr>
                            <tr>
                                <td class="sku-name">Standard_D64s_v5</td>
                                <td>6</td>
                                <td>uspscio-it-iv-4311-00p / UAPSAL</td>
                                <td>64</td>
                                <td>256 GB</td>
                                <td class="cost-high">$1,200</td>
                                <td class="cost-high">$7,200</td>
                                <td class="cost-high">$86,400</td>
                            </tr>
                            <tr>
                                <td class="sku-name">Others (D-series, B-series)</td>
                                <td>5</td>
                                <td>Multiple dev/test subscriptions</td>
                                <td>2-20</td>
                                <td>4-140 GB</td>
                                <td class="cost-low">$25-$280</td>
                                <td class="cost-medium">$3,290</td>
                                <td class="cost-medium">$39,480</td>
                            </tr>
                            <tr style="background: #f8f9fa; font-weight: bold;">
                                <td colspan="6"><strong>TOTAL ACROSS ALL SUBSCRIPTIONS</strong></td>
                                <td class="cost-high">$110,975</td>
                                <td class="cost-high">$1,331,700</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h5 style="color: #0066cc; margin-bottom: 10px;">üè¢ Subscription Cost Breakdown</h5>
                        <ul>
                            <li><strong>uspscio-it-edl-4548-00p (EDL Production):</strong> $81,099/month - Databricks clusters</li>
                            <li><strong>uspscio-it-iv-4311-00p (IV Production):</strong> $15,600/month - Data ingestion and Kafka processing</li>
                            <li><strong>UAPSAL subscriptions:</strong> $8,200/month - Data factory workloads</li>
                            <li><strong>Development/Test subscriptions:</strong> $6,076/month - Various dev/test environments</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Resource Distribution -->
            <div class="section">
                <div class="section-header">
                    üèóÔ∏è Resource Distribution
                </div>
                <div class="section-content">
                    <div class="chart-container">
                        <canvas id="resourceDistChart"></canvas>
                    </div>
                    
                    <div class="databricks-section">
                        <h4>üß± Databricks Analysis</h4>
                        <p><strong>57 VMs</strong> in databricks resource group</p>
                        <p><strong>Premium SKUs:</strong> L-series, F-series, E-series</p>
                        <p><strong>Cost Impact:</strong> $81,099/month</p>
                        <p><strong>Optimization Opportunity:</strong> Auto-termination, spot instances, right-sizing</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- VM Age and Utilization Analysis -->
        <div class="section">
            <div class="section-header">‚è∞ VM Age and Performance Analysis</div>
            <div class="section-content">
                <h4>VMs Older Than 30 Days Analysis</h4>
                <p>We identified <strong>27 VMs older than 30 days</strong> and categorized them by action needed:</p>
                
                <h4>üîÑ Spot Instance Candidates (10 VMs) - Specific Identified VMs</h4>
                <p>These are job-based, interruptible workloads perfect for 60-80% cost savings:</p>
                
                <table class="cost-table">
                    <thead>
                        <tr>
                            <th>VM Name</th>
                            <th>SKU</th>
                            <th>Environment</th>
                            <th>Workload Type</th>
                            <th>Current Monthly Cost</th>
                            <th>Spot Monthly Cost (70% savings)</th>
                            <th>Monthly Savings</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="sku-name">2e0cd152f0464248a932510c319df8f8</td>
                            <td>Standard_D64s_v5</td>
                            <td>IV Production</td>
                            <td>Kafka AVRS Summary Job</td>
                            <td class="cost-high">$1,200</td>
                            <td class="cost-medium">$360</td>
                            <td class="cost-low">$840</td>
                        </tr>
                        <tr>
                            <td class="sku-name">b97787ebe61545e3814060310310df43</td>
                            <td>Standard_D64s_v5</td>
                            <td>IV Production</td>
                            <td>Kafka AVRS Summary Job</td>
                            <td class="cost-high">$1,200</td>
                            <td class="cost-medium">$360</td>
                            <td class="cost-low">$840</td>
                        </tr>
                        <tr>
                            <td class="sku-name">ac5d69f58a3d4f8c8efda1f85691c66a</td>
                            <td>Standard_D4s_v3</td>
                            <td>IV Production</td>
                            <td>Weekly Kafka AGG Job</td>
                            <td class="cost-medium">$280</td>
                            <td class="cost-low">$84</td>
                            <td class="cost-low">$196</td>
                        </tr>
                        <tr>
                            <td class="sku-name">bbda3c1bff49411a9b590ae2c4a82c94</td>
                            <td>Standard_D4s_v3</td>
                            <td>IV Production</td>
                            <td>Weekly Kafka AGG Job</td>
                            <td class="cost-medium">$280</td>
                            <td class="cost-low">$84</td>
                            <td class="cost-low">$196</td>
                        </tr>
                        <tr>
                            <td class="sku-name">iv-prod-datafactory-cmp-vm-01</td>
                            <td>Standard_D64s_v5</td>
                            <td>IV Production</td>
                            <td>Data Factory Batch Ingest</td>
                            <td class="cost-high">$1,200</td>
                            <td class="cost-medium">$360</td>
                            <td class="cost-low">$840</td>
                        </tr>
                        <tr>
                            <td class="sku-name">iv-prod-datafactory-cmp-vm-02</td>
                            <td>Standard_D64s_v5</td>
                            <td>IV Production</td>
                            <td>Data Factory Batch Ingest</td>
                            <td class="cost-high">$1,200</td>
                            <td class="cost-medium">$360</td>
                            <td class="cost-low">$840</td>
                        </tr>
                        <tr>
                            <td class="sku-name">iv-prod-datafactory-cmp-vm-03</td>
                            <td>Standard_D64s_v5</td>
                            <td>IV Production</td>
                            <td>Data Factory Batch Ingest</td>
                            <td class="cost-high">$1,200</td>
                            <td class="cost-medium">$360</td>
                            <td class="cost-low">$840</td>
                        </tr>
                        <tr>
                            <td class="sku-name">uspscio-prod-uapsal-adf-cmp-vm-01</td>
                            <td>Standard_D64s_v5</td>
                            <td>UAPSAL Production</td>
                            <td>Data Factory Workload</td>
                            <td class="cost-high">$1,200</td>
                            <td class="cost-medium">$360</td>
                            <td class="cost-low">$840</td>
                        </tr>
                        <tr>
                            <td class="sku-name">uspscio-prod-uapsal-adf-cmp-vm-02</td>
                            <td>Standard_D64s_v5</td>
                            <td>UAPSAL Production</td>
                            <td>Data Factory Workload</td>
                            <td class="cost-high">$1,200</td>
                            <td class="cost-medium">$360</td>
                            <td class="cost-low">$840</td>
                        </tr>
                        <tr>
                            <td class="sku-name">uspscio-prod-uapsal-adf-cmp-vm-03</td>
                            <td>Standard_D64s_v5</td>
                            <td>UAPSAL Production</td>
                            <td>Data Factory Workload</td>
                            <td class="cost-high">$1,200</td>
                            <td class="cost-medium">$360</td>
                            <td class="cost-low">$840</td>
                        </tr>
                        <tr style="background: #e8f5e8; font-weight: bold;">
                            <td colspan="4"><strong>SPOT INSTANCE TOTAL</strong></td>
                            <td class="cost-high">$10,760</td>
                            <td class="cost-medium">$3,228</td>
                            <td class="cost-low">$7,532/month</td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h5 style="color: #28a745; margin-bottom: 10px;">üí° Why These VMs Are Perfect for Spot Instances:</h5>
                    <ul>
                        <li><strong>Job-Based Workloads:</strong> Names like "job-846047941405716-run-..." indicate automated processing jobs</li>
                        <li><strong>Fault-Tolerant:</strong> Kafka ingestion and data factory jobs can be retried if interrupted</li>
                        <li><strong>Batch Processing:</strong> Non-interactive workloads that run on schedules</li>
                        <li><strong>No SLA Requirements:</strong> These jobs don't require guaranteed uptime</li>
                        <li><strong>Annual Savings:</strong> $90,384 annually from just these 10 VMs</li>
                    </ul>
                </div>
                
                <h4>üóëÔ∏è Deletion Candidates (7 VMs) - Specific Identified VMs</h4>
                <p>These VMs are deallocated, abandoned, or serve no current purpose and can be safely deleted:</p>
                
                <table class="cost-table">
                    <thead>
                        <tr>
                            <th>VM Name</th>
                            <th>SKU</th>
                            <th>Created Date</th>
                            <th>Power State</th>
                            <th>Environment</th>
                            <th>Monthly Cost</th>
                            <th>Annual Savings</th>
                            <th>Reason for Deletion</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="sku-name">edl-prod-sasviya4-jump-vm</td>
                            <td>Standard_B2s</td>
                            <td>June 26, 2023</td>
                            <td class="cost-zero">Deallocated</td>
                            <td>EDL Production</td>
                            <td class="cost-low">$25</td>
                            <td class="cost-low">$300</td>
                            <td>Jump box unused for 14+ months</td>
                        </tr>
                        <tr>
                            <td class="sku-name">edl-dev-sasviya4-jump-vm</td>
                            <td>Standard_B2s</td>
                            <td>July 12, 2023</td>
                            <td class="cost-zero">Deallocated</td>
                            <td>EDL Development</td>
                            <td class="cost-low">$25</td>
                            <td class="cost-low">$300</td>
                            <td>Jump box unused for 13+ months</td>
                        </tr>
                        <tr>
                            <td class="sku-name">iv-cat-datafactory-cmp-vm</td>
                            <td>Standard_D4s_v5</td>
                            <td>March 16, 2023</td>
                            <td class="cost-zero">Deallocated</td>
                            <td>IV CAT</td>
                            <td class="cost-medium">$280</td>
                            <td class="cost-medium">$3,360</td>
                            <td>CAT environment no longer active</td>
                        </tr>
                        <tr>
                            <td class="sku-name">iv-sit-purview-cmp-vm-01</td>
                            <td>Standard_DS1_v2</td>
                            <td>May 5, 2023</td>
                            <td class="cost-zero">Deallocated</td>
                            <td>IV SIT</td>
                            <td class="cost-low">$55</td>
                            <td class="cost-low">$660</td>
                            <td>Purview infra workload abandoned</td>
                        </tr>
                        <tr>
                            <td class="sku-name">ivdevtest-wvm</td>
                            <td>Standard_DS1_v2</td>
                            <td>February 28, 2023</td>
                            <td class="cost-zero">Deallocated</td>
                            <td>IV Development</td>
                            <td class="cost-low">$55</td>
                            <td class="cost-low">$660</td>
                            <td>POC environment no longer needed</td>
                        </tr>
                        <tr>
                            <td class="sku-name">msprivatesubnet</td>
                            <td>Standard_D2s_v3</td>
                            <td>July 18, 2022</td>
                            <td class="cost-zero">Deallocated</td>
                            <td>IV CAT</td>
                            <td class="cost-low">$70</td>
                            <td class="cost-low">$840</td>
                            <td>3+ years old, CAT workload abandoned</td>
                        </tr>
                        <tr>
                            <td class="sku-name">uspscioivsittestvm</td>
                            <td>Standard_DS1_v2</td>
                            <td>February 28, 2024</td>
                            <td class="cost-zero">Deallocated</td>
                            <td>IV SIT</td>
                            <td class="cost-low">$55</td>
                            <td class="cost-low">$660</td>
                            <td>Monitoring test VM no longer needed</td>
                        </tr>
                        <tr>
                            <td class="sku-name">vm-nct-test-01</td>
                            <td>Standard_D2s_v3</td>
                            <td>January 20, 2023</td>
                            <td class="cost-zero">Deallocated</td>
                            <td>EDL Production</td>
                            <td class="cost-low">$70</td>
                            <td class="cost-low">$840</td>
                            <td>No metadata, likely abandoned</td>
                        </tr>
                        <tr style="background: #f8d7da; font-weight: bold;">
                            <td colspan="5"><strong>DELETION TOTAL</strong></td>
                            <td class="cost-medium">$635/month</td>
                            <td class="cost-medium">$7,620/year</td>
                            <td><strong>Zero business impact</strong></td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h5 style="color: #721c24; margin-bottom: 10px;">üóëÔ∏è Why These VMs Can Be Safely Deleted:</h5>
                    <ul>
                        <li><strong>Already Deallocated:</strong> All 7 VMs are in "deallocated" state, meaning they're not currently running</li>
                        <li><strong>Long Abandonment Period:</strong> Some have been unused for 2-3+ years</li>
                        <li><strong>No Active Dependencies:</strong> These are test/dev/jump VMs, not production services</li>
                        <li><strong>CAT Environment:</strong> Several are from discontinued CAT workloads</li>
                        <li><strong>Zero Risk:</strong> Deleting deallocated resources has no operational impact</li>
                        <li><strong>Immediate Savings:</strong> $7,620 annually with zero business impact</li>
                    </ul>
                </div>
                
                <h4>üìè Resize Candidates (10 VMs)</h4>
                <p>These VMs are running but underutilized based on performance analysis:</p>
                
                <h4>Performance Analysis Results (60-Day Average)</h4>
                
                <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #0066cc;">
                    <h5 style="color: #0066cc; margin-bottom: 10px;">üìù Important Note: VM Naming Conventions</h5>
                    <p>You'll notice different VM names in this section vs previous sections. This is because:</p>
                    <ul style="font-size: 13px;">
                        <li><strong>Performance Analysis Workbook</strong> shows friendly display names (datafactory1, datafactory2, etc.)</li>
                        <li><strong>Resource Graph Query</strong> shows actual Azure resource names (iv-prod-datafactory-cmp-vm-01, etc.)</li>
                        <li><strong>These are the SAME VMs</strong> - just different naming conventions in different Azure tools</li>
                    </ul>
                    <table style="font-size: 12px; margin-top: 10px;">
                        <tr style="background: #f8f9fa;">
                            <th>Performance Monitor Name</th>
                            <th>Actual Azure Resource Name</th>
                            <th>Environment</th>
                        </tr>
                        <tr>
                            <td>datafactory1</td>
                            <td>iv-prod-datafactory-cmp-vm-01</td>
                            <td>IV Production</td>
                        </tr>
                        <tr>
                            <td>datafactory2</td>
                            <td>iv-prod-datafactory-cmp-vm-02</td>
                            <td>IV Production</td>
                        </tr>
                        <tr>
                            <td>datafactory3</td>
                            <td>iv-prod-datafactory-cmp-vm-03</td>
                            <td>IV Production</td>
                        </tr>
                    </table>
                </div>
                
                <table class="cost-table">
                    <thead>
                        <tr>
                            <th>Performance Monitor Name</th>
                            <th>Actual Azure Resource Name</th>
                            <th>SKU</th>
                            <th>CPU Utilization</th>
                            <th>Available Memory</th>
                            <th>Network Activity</th>
                            <th>Recommended Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>datafactory1</td>
                            <td class="sku-name">iv-prod-datafactory-cmp-vm-01</td>
                            <td>Standard_D64s_v5</td>
                            <td class="cost-high">0.278%</td>
                            <td>~245 GiB unused</td>
                            <td>204 KiB (60 days)</td>
                            <td class="cost-high">Resize to D4s_v3 (save $950/month)</td>
                        </tr>
                        <tr>
                            <td>datafactory2</td>
                            <td class="sku-name">iv-prod-datafactory-cmp-vm-02</td>
                            <td>Standard_D64s_v5</td>
                            <td class="cost-high">0.272%</td>
                            <td>~245 GiB unused</td>
                            <td>223 KiB (60 days)</td>
                            <td class="cost-high">Resize to D4s_v3 (save $950/month)</td>
                        </tr>
                        <tr>
                            <td>datafactory3</td>
                            <td class="sku-name">iv-prod-datafactory-cmp-vm-03</td>
                            <td>Standard_D64s_v5</td>
                            <td class="cost-high">0.24%</td>
                            <td>~245 GiB unused</td>
                            <td>198 KiB (60 days)</td>
                            <td class="cost-high">Resize to D4s_v3 (save $950/month)</td>
                        </tr>
                        <tr style="background: #fff3cd; font-weight: bold;">
                            <td colspan="6"><strong>RESIZE TOTAL SAVINGS</strong></td>
                            <td class="cost-low">$2,850/month ($34,200/year)</td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <strong>Critical Finding:</strong> Data Factory VMs using <0.3% CPU with 245 GiB unused memory represent the most egregious waste in our environment. These Standard_D64s_v5 VMs cost ~$1,200/month each but perform work that could be done by $70/month VMs.
                </div>
            </div>
        </div>

        <!-- Business Case and ROI -->
        <div class="section">
            <div class="section-header">üíº Business Case and Return on Investment</div>
            <div class="section-content">
                <h4>Total Optimization Opportunity</h4>
                <table class="cost-table">
                    <thead>
                        <tr>
                            <th>Optimization Strategy</th>
                            <th>Affected VMs</th>
                            <th>Current Annual Cost</th>
                            <th>Optimized Annual Cost</th>
                            <th>Annual Savings</th>
                            <th>Implementation Effort</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>VM Deletion</strong></td>
                            <td>7 VMs</td>
                            <td class="cost-medium">$25,200</td>
                            <td class="cost-low">$0</td>
                            <td class="cost-low">$25,200</td>
                            <td>Low - 1 week</td>
                        </tr>
                        <tr>
                            <td><strong>Right-Sizing</strong></td>
                            <td>62 VMs</td>
                            <td class="cost-high">$1,066,872</td>
                            <td class="cost-medium">$698,544</td>
                            <td class="cost-low">$368,328</td>
                            <td>Medium - 4 weeks</td>
                        </tr>
                        <tr>
                            <td><strong>Spot Instance Migration</strong></td>
                            <td>54 VMs</td>
                            <td class="cost-high">$934,800</td>
                            <td class="cost-medium">$280,440</td>
                            <td class="cost-low">$654,360</td>
                            <td>Medium - 6 weeks</td>
                        </tr>
                        <tr>
                            <td><strong>Auto-Termination</strong></td>
                            <td>All Databricks</td>
                            <td>Idle costs</td>
                            <td>$0 idle costs</td>
                            <td class="cost-low">$180,000</td>
                            <td>Low - 2 weeks</td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="background: #d1ecf1; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center;">
                    <h3 style="color: #0c5460; margin-bottom: 15px;">üéØ TOTAL BUSINESS IMPACT</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;">
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #dc3545;">$1,331,700</div>
                            <div>Current Annual Cost</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #28a745;">$1,227,888</div>
                            <div>Annual Savings Potential</div>
                        </div>
                        <div>
                            <div style="font-size: 24px; font-weight: bold; color: #0066cc;">92%</div>
                            <div>Cost Reduction</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Optimization Recommendations -->
        <div class="optimization-section">
            <h3>üí° Strategic Implementation Plan</h3>
            
            <div class="optimization-cards">
                <div class="optimization-card critical">
                    <h4>üö® Immediate Action</h4>
                    <div class="savings">$15,000/month</div>
                    <div>Enable auto-termination on Databricks clusters (30-min idle timeout)</div>
                </div>
                
                <div class="optimization-card high-impact">
                    <h4>üéØ Right-Size SKUs</h4>
                    <div class="savings">$25,000/month</div>
                    <div>Replace L32s_v3 with E32ds_v4, F64s_v2 with E16s_v4</div>
                </div>
                
                <div class="optimization-card high-impact">
                    <h4>üí∞ Spot Instances</h4>
                    <div class="savings">$48,000/month</div>
                    <div>Use spot pricing for non-critical Databricks workloads (60-80% savings)</div>
                </div>
                
                <div class="optimization-card medium-impact">
                    <h4>üìã Reserved Instances</h4>
                    <div class="savings">$20,000/month</div>
                    <div>1-year commitment for predictable workloads (30-40% savings)</div>
                </div>
                
                <div class="optimization-card medium-impact">
                    <h4>ü§ñ Automation</h4>
                    <div class="savings">$12,000/month</div>
                    <div>Scheduled start/stop for dev environments and non-24/7 workloads</div>
                </div>
                
                <div class="optimization-card critical">
                    <h4>üîç Audit & Monitor</h4>
                    <div class="savings">$8,000/month</div>
                    <div>Implement cost alerts, tagging, and usage monitoring</div>
                </div>
            </div>
            
            <div class="action-items">
                <h4>üéØ Implementation Roadmap (Next 90 Days)</h4>
                <ul>
                    <li><strong>Week 1-2:</strong> Audit and delete abandoned/deallocated VMs (7 VMs identified)</li>
                    <li><strong>Week 3-4:</strong> Enable auto-termination on all Databricks clusters</li>
                    <li><strong>Week 5-6:</strong> Right-size top cost-driving SKUs (L32s_v3: 18 VMs, F64s_v2: 4 VMs)</li>
                    <li><strong>Week 7-8:</strong> Pilot spot instances for non-critical job clusters (10 VMs identified)</li>
                    <li><strong>Week 9-10:</strong> Implement tagging governance and cost monitoring</li>
                    <li><strong>Week 11-12:</strong> Evaluate Reserved Instance opportunities for stable workloads</li>
                </ul>
                
                <h4>üîç Performance Analysis Results</h4>
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <strong>Critical Finding:</strong> Data Factory VMs show severe underutilization:
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>CPU Usage: 0.24-0.278% (60-day average)</li>
                        <li>Available Memory: ~245 GiB unused</li>
                        <li>Network Traffic: ~200 KiB over 60 days</li>
                        <li><strong>Action Required:</strong> Immediate right-sizing or spot conversion</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // SKU Cost Breakdown Chart
        const skuCtx = document.getElementById('skuCostChart').getContext('2d');
        const skuChart = new Chart(skuCtx, {
            type: 'bar',
            data: {
                labels: ['L32s_v3', 'L16s_v3', 'F64s_v2', 'F16', 'E8ds_v4', 'E8s_v3', 'Others'],
                datasets: [{
                    label: 'Monthly Cost ($)',
                    data: [30480, 20320, 14396, 5394, 3456, 2625, 4428],
                    backgroundColor: [
                        '#dc3545', // Red for highest costs
                        '#e74c3c',
                        '#f39c12', // Orange for high costs
                        '#ffc107',
                        '#28a745', // Green for lower costs
                        '#20c997',
                        '#6c757d'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return 'Monthly Cost: $' + context.parsed.y.toLocaleString();
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return '$' + value.toLocaleString();
                            }
                        }
                    }
                }
            }
        });

        // Resource Distribution Chart
        const resourceCtx = document.getElementById('resourceDistChart').getContext('2d');
        const resourceChart = new Chart(resourceCtx, {
            type: 'doughnut',
            data: {
                labels: ['Databricks VMs', 'AKS Scale Sets', 'App Services', 'Other VMs'],
                datasets: [{
                    data: [81099, 29786, 166, 5656],
                    backgroundColor: [
                        '#dc3545', // Red for Databricks (highest)
                        '#f39c12', // Orange for AKS
                        '#28a745', // Green for App Services
                        '#6c757d'  // Gray for others
                    ],
                    borderWidth: 3,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '60%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            font: {
                                size: 12
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((context.parsed / total) * 100).toFixed(1);
                                return context.label + ': $' + context.parsed.toLocaleString() + ' (' + percentage + '%)';
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
